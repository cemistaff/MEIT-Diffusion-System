{
	"patcher" : 	{
		"fileversion" : 1,
		"appversion" : 		{
			"major" : 8,
			"minor" : 0,
			"revision" : 4,
			"architecture" : "x64",
			"modernui" : 1
		}
,
		"classnamespace" : "dsp.gen",
		"rect" : [ 1214.0, 598.0, 1314.0, 885.0 ],
		"bglocked" : 0,
		"openinpresentation" : 0,
		"default_fontsize" : 10.0,
		"default_fontface" : 0,
		"default_fontname" : "Futura Medium",
		"gridonopen" : 1,
		"gridsize" : [ 15.0, 15.0 ],
		"gridsnaponopen" : 1,
		"objectsnaponopen" : 1,
		"statusbarvisible" : 2,
		"toolbarvisible" : 1,
		"lefttoolbarpinned" : 0,
		"toptoolbarpinned" : 0,
		"righttoolbarpinned" : 0,
		"bottomtoolbarpinned" : 0,
		"toolbars_unpinned_last_save" : 4,
		"tallnewobj" : 0,
		"boxanimatetime" : 200,
		"enablehscroll" : 1,
		"enablevscroll" : 1,
		"devicewidth" : 0.0,
		"description" : "",
		"digest" : "",
		"tags" : "",
		"style" : "Minimal",
		"subpatcher_template" : "minimal",
		"boxes" : [ 			{
				"box" : 				{
					"id" : "obj-14",
					"maxclass" : "newobj",
					"numinlets" : 0,
					"numoutlets" : 1,
					"outlettype" : [ "" ],
					"patching_rect" : [ 216.999979654947907, 123.0, 26.0, 21.0 ],
					"text" : "in 2"
				}

			}
, 			{
				"box" : 				{
					"id" : "obj-11",
					"maxclass" : "newobj",
					"numinlets" : 2,
					"numoutlets" : 1,
					"outlettype" : [ "" ],
					"patching_rect" : [ 709.0, 445.0, 29.5, 21.0 ],
					"text" : "/"
				}

			}
, 			{
				"box" : 				{
					"id" : "obj-10",
					"maxclass" : "newobj",
					"numinlets" : 1,
					"numoutlets" : 1,
					"outlettype" : [ "" ],
					"patching_rect" : [ 734.33331298828125, 348.0, 20.0, 21.0 ],
					"text" : "- 1"
				}

			}
, 			{
				"box" : 				{
					"id" : "obj-9",
					"maxclass" : "newobj",
					"numinlets" : 0,
					"numoutlets" : 1,
					"outlettype" : [ "" ],
					"patching_rect" : [ 759.83331298828125, 375.0, 19.0, 21.0 ],
					"text" : "0"
				}

			}
, 			{
				"box" : 				{
					"id" : "obj-8",
					"maxclass" : "newobj",
					"numinlets" : 3,
					"numoutlets" : 1,
					"outlettype" : [ "" ],
					"patching_rect" : [ 689.83331298828125, 381.0, 40.0, 21.0 ],
					"text" : "wrap"
				}

			}
, 			{
				"box" : 				{
					"id" : "obj-4",
					"maxclass" : "newobj",
					"numinlets" : 3,
					"numoutlets" : 3,
					"outlettype" : [ "", "", "" ],
					"patching_rect" : [ 689.83331298828125, 341.0, 42.0, 21.0 ],
					"text" : "counter"
				}

			}
, 			{
				"box" : 				{
					"id" : "obj-13",
					"maxclass" : "newobj",
					"numinlets" : 0,
					"numoutlets" : 1,
					"outlettype" : [ "" ],
					"patching_rect" : [ 774.0, 413.0, 58.0, 21.0 ],
					"text" : "r bufferLen"
				}

			}
, 			{
				"box" : 				{
					"id" : "obj-3",
					"maxclass" : "newobj",
					"numinlets" : 0,
					"numoutlets" : 1,
					"outlettype" : [ "" ],
					"patching_rect" : [ 745.5, 321.0, 58.0, 21.0 ],
					"text" : "r bufferLen"
				}

			}
, 			{
				"box" : 				{
					"id" : "obj-1",
					"maxclass" : "newobj",
					"numinlets" : 1,
					"numoutlets" : 0,
					"patching_rect" : [ 699.83331298828125, 587.0, 32.0, 21.0 ],
					"text" : "out 2"
				}

			}
, 			{
				"box" : 				{
					"id" : "obj-2",
					"maxclass" : "newobj",
					"numinlets" : 1,
					"numoutlets" : 0,
					"patching_rect" : [ 684.83331298828125, 488.0, 62.0, 21.0 ],
					"text" : "s sampleNo"
				}

			}
, 			{
				"box" : 				{
					"id" : "obj-12",
					"maxclass" : "newobj",
					"numinlets" : 2,
					"numoutlets" : 1,
					"outlettype" : [ "" ],
					"patching_rect" : [ 73.33331298828125, 557.0, 29.5, 21.0 ],
					"text" : "+"
				}

			}
, 			{
				"box" : 				{
					"id" : "obj-6",
					"maxclass" : "newobj",
					"numinlets" : 1,
					"numoutlets" : 1,
					"outlettype" : [ "" ],
					"patching_rect" : [ 83.83331298828125, 528.0, 39.0, 21.0 ],
					"text" : "history"
				}

			}
, 			{
				"box" : 				{
					"id" : "obj-7",
					"maxclass" : "newobj",
					"numinlets" : 0,
					"numoutlets" : 2,
					"outlettype" : [ "", "" ],
					"patching_rect" : [ 676.5, 113.0, 67.0, 21.0 ],
					"text" : "buffer delBuf"
				}

			}
, 			{
				"box" : 				{
					"id" : "obj-5",
					"maxclass" : "newobj",
					"numinlets" : 1,
					"numoutlets" : 0,
					"patching_rect" : [ 676.5, 145.0, 58.0, 21.0 ],
					"text" : "s bufferLen"
				}

			}
, 			{
				"box" : 				{
					"id" : "obj-47",
					"maxclass" : "newobj",
					"numinlets" : 0,
					"numoutlets" : 1,
					"outlettype" : [ "" ],
					"patching_rect" : [ 73.33331298828125, 123.0, 26.0, 21.0 ],
					"text" : "in 1"
				}

			}
, 			{
				"box" : 				{
					"id" : "obj-42",
					"maxclass" : "newobj",
					"numinlets" : 0,
					"numoutlets" : 1,
					"outlettype" : [ "" ],
					"patching_rect" : [ 504.33331298828125, 130.0, 62.0, 21.0 ],
					"text" : "r sampleNo"
				}

			}
, 			{
				"box" : 				{
					"id" : "obj-39",
					"maxclass" : "newobj",
					"numinlets" : 0,
					"numoutlets" : 1,
					"outlettype" : [ "" ],
					"patching_rect" : [ 73.33331298828125, 489.0, 70.0, 21.0 ],
					"text" : "r meshOutput"
				}

			}
, 			{
				"box" : 				{
					"id" : "obj-36",
					"maxclass" : "newobj",
					"numinlets" : 1,
					"numoutlets" : 0,
					"patching_rect" : [ 73.33331298828125, 432.0, 70.0, 21.0 ],
					"text" : "s meshOutput"
				}

			}
, 			{
				"box" : 				{
					"id" : "obj-26",
					"maxclass" : "newobj",
					"numinlets" : 1,
					"numoutlets" : 1,
					"outlettype" : [ "" ],
					"patching_rect" : [ 73.33331298828125, 594.5, 50.0, 21.0 ],
					"text" : "clip -1. 1."
				}

			}
, 			{
				"box" : 				{
					"id" : "obj-89",
					"maxclass" : "comment",
					"numinlets" : 1,
					"numoutlets" : 0,
					"patching_rect" : [ 676.5, 237.0, 127.0, 19.0 ],
					"text" : "sample counter"
				}

			}
, 			{
				"box" : 				{
					"id" : "obj-43",
					"maxclass" : "newobj",
					"numinlets" : 1,
					"numoutlets" : 1,
					"outlettype" : [ "" ],
					"patching_rect" : [ 73.33331298828125, 635.75, 44.0, 21.0 ],
					"text" : "dcblock"
				}

			}
, 			{
				"box" : 				{
					"id" : "obj-18",
					"maxclass" : "newobj",
					"numinlets" : 0,
					"numoutlets" : 1,
					"outlettype" : [ "" ],
					"patching_rect" : [ 360.666646321614564, 130.0, 72.0, 21.0 ],
					"text" : "r lookupSamp"
				}

			}
, 			{
				"box" : 				{
					"code" : "getChannel(row,col, squareSide){\r\n\treturn (row*squareSide+col)*4;\r\n\t} \r\n\t\r\nParam RC(0.8);\r\nParam damp(0.1);\r\nd = 1-clip(damp, 0,1);\r\nreflection = 0-clip(RC, 0, 0.99999);\r\ninput = in1;\r\ndt = in2;\r\ndt = floor(dt);\r\nlookup = in3;\r\nposition = in4;\r\n\r\nnCh = voicecount;\r\nch = voice-1;\r\n\r\nlen = dim(delBuf);\r\n\r\noutput = 0;\r\ntoWall = 0;\r\n\r\n\r\noutputT = 0;\r\noutputB= 0;\r\noutputL = 0;\r\noutputR = 0;\r\n\r\nwallT = 0;\r\nwallB= 0;\r\nwallL = 0;\r\nwallR = 0;\r\n\r\ntopOffset = 0;\r\nbottomOffset = 1;\r\nleftOffset = 2;\r\nrightOffset = 3;\r\n\r\n\r\n\r\nZj = 0;\r\n\r\n\r\nsquareSide = floor(sqrt(nCh));\r\nrow = floor(ch/squareSide);\r\ncol = ch % (squareSide);\r\n\r\n//Top Side\r\nchan = getChannel(row,col,squareSide);\r\n\r\n\t\tif (row == 0){ //Is it the top wall?\r\n\t\t\tchan = getChannel(row,col,squareSide);\r\n\t\t\tlookupChan = chan+topOffset;\r\n\t\t\toutputT, index = peek(delBuf, wrap(position-dt,0,len-1), lookupChan);\r\n\t\t\twallT = 1;\r\n\t\t\t}\r\n\t\t\r\n\t\telse{ //If it is not the top row, grab a sample from above\r\n\t\t\tchan = getChannel(row-1, col,squareSide);\r\n\t\t\tlookupChan = chan+bottomOffset;\r\n\t\t\toutputT, index = peek(delBuf, wrap(position-dt,0,len-1), lookupChan);\t\t\r\n\t\t\t}\r\n\t\t\toutputT *= d;\r\n\t\t\toutputT += input*0.25;\r\n\t\t\t\r\n//Bottom Side\r\n\r\n\t\tif (row == squareSide - 1){ //Is it the bottom wall?\r\n\t\t\tchan = getChannel(row,col,squareSide);\t\r\n\t\t    lookupChan = chan+bottomOffset;\r\n\t\t\toutputB, index = peek(delBuf, wrap(position-dt,0,len-1), lookupChan);\r\n\t\t\twallB = 1;\r\n\t\t\t}\r\n\t\t\t\r\n\t\telse{\r\n\t\t\tchan = getChannel(row+1,col,squareSide);\r\n\t\t\tlookupChan = chan+topOffset;\r\n\t\t\toutputB, index = peek(delBuf, wrap(position-dt,0,len-1), lookupChan);\r\n\t\t\t}\r\n\t\t    outputB*= d;\r\n\t\t\toutputB += input*0.25;\r\n\t\t\t\r\n//Left Side\t\t\t\r\n\t\t\r\n\t\tif (col == 0) {  //Is it the left wall?\r\n\t\t\tchan = getChannel(row,col,squareSide);\r\n\t\t    lookupChan = chan+leftOffset;\r\n\t\t\toutputL, index = peek(delBuf, wrap(position-dt,0,len-1), lookupChan);\r\n\t\t\twallL = 1;\r\n\t\t\t\r\n\t\t\t}\r\n\t\t\r\n\t\telse{\r\n\t\t\tchan = getChannel(row,col-1,squareSide);\r\n\t\t    lookupChan = chan+rightOffset;\r\n\t\t\toutputL, index = peek(delBuf, wrap(position-dt,0,len-1), lookupChan);\r\n\t\t\t}\r\n\t\t\toutputL *= d;\r\n\t\t\toutputL += input*0.25;\r\n\r\n//Right Side\r\n\t\t\t\t\t\t\t\t\t\r\n\t\tif( col == squareSide-1 ){ //Is it the right wall?\r\n\t\t\tchan = getChannel(row,col);\r\n\t\t    lookupChan = chan+rightOffset;\r\n\t\t\toutputR, index = peek(delBuf, wrap(position-dt,0,len-1), chan+rightOffset);\r\n\t\t\twallR = 1;\r\n\t\t\t}\r\n\t\t\r\n\t\telse{\r\n\t\t\tchan = getChannel(row,col+1);\r\n\t\t\tlookupChan = chan+leftOffset;\r\n\t\t\toutputR, index = peek(delBuf, wrap(position-dt,0,len-1), chan+leftOffset);\r\n\t\t\t}\r\n\t\toutputR *= d;\r\n\t\toutputR += input*0.25;\r\n\t\t\r\nZj = (outputT+outputB+outputL+outputR)*0.5;\r\n\r\nwriteT= (Zj-outputT)*((reflection*wallT)+1*(1-wallT));\r\nwriteB= (Zj-outputB)*((reflection*wallB)+1*(1-wallB));\r\nwriteL= (Zj-outputL)*((reflection*wallL)+1*(1-wallL));\r\nwriteR= (Zj-outputR)*((reflection*wallR)+1*(1-wallR));\r\n\t\r\npoke(delBuf, writeT, position, ch*4+topOffset,0);\r\npoke(delBuf, writeB , position, ch*4+bottomOffset,0);\r\npoke(delBuf, writeL , position, ch*4+leftOffset,0);\r\npoke(delBuf, writeR , position, ch*4+rightOffset,0);\r\n\r\nclearPos = wrap(position+vectorsize, 0, len-1);\r\n\r\npoke(delBuf, 0,clearPos , ch*4+topOffset, 0);\r\npoke(delBuf, 0, clearPos, ch*4+bottomOffset, 0);\r\npoke(delBuf, 0, clearPos, ch*4+leftOffset, 0);\r\npoke(delBuf, 0, clearPos, ch*4+rightOffset, 0);\r\nout1 = Zj;",
					"fontface" : 0,
					"fontname" : "<Monospaced>",
					"fontsize" : 10.0,
					"id" : "obj-38",
					"maxclass" : "codebox",
					"numinlets" : 4,
					"numoutlets" : 1,
					"outlettype" : [ "" ],
					"patching_rect" : [ 73.33331298828125, 176.0, 450.0, 240.0 ]
				}

			}
, 			{
				"box" : 				{
					"id" : "obj-27",
					"maxclass" : "newobj",
					"numinlets" : 1,
					"numoutlets" : 0,
					"patching_rect" : [ 73.33331298828125, 671.75, 32.0, 21.0 ],
					"text" : "out 1"
				}

			}
, 			{
				"box" : 				{
					"angle" : 270.0,
					"background" : 1,
					"bgcolor" : [ 0.65098, 0.666667, 0.662745, 0.0 ],
					"border" : 3,
					"id" : "obj-87",
					"maxclass" : "panel",
					"mode" : 0,
					"numinlets" : 1,
					"numoutlets" : 0,
					"patching_rect" : [ 646.83331298828125, 219.5, 195.0, 401.5 ],
					"proportion" : 0.39
				}

			}
 ],
		"lines" : [ 			{
				"patchline" : 				{
					"destination" : [ "obj-8", 2 ],
					"source" : [ "obj-10", 0 ]
				}

			}
, 			{
				"patchline" : 				{
					"destination" : [ "obj-1", 0 ],
					"source" : [ "obj-11", 0 ]
				}

			}
, 			{
				"patchline" : 				{
					"destination" : [ "obj-26", 0 ],
					"source" : [ "obj-12", 0 ]
				}

			}
, 			{
				"patchline" : 				{
					"destination" : [ "obj-11", 1 ],
					"source" : [ "obj-13", 0 ]
				}

			}
, 			{
				"patchline" : 				{
					"destination" : [ "obj-38", 1 ],
					"source" : [ "obj-14", 0 ]
				}

			}
, 			{
				"patchline" : 				{
					"destination" : [ "obj-38", 2 ],
					"source" : [ "obj-18", 0 ]
				}

			}
, 			{
				"patchline" : 				{
					"destination" : [ "obj-43", 0 ],
					"source" : [ "obj-26", 0 ]
				}

			}
, 			{
				"patchline" : 				{
					"destination" : [ "obj-10", 0 ],
					"source" : [ "obj-3", 0 ]
				}

			}
, 			{
				"patchline" : 				{
					"destination" : [ "obj-36", 0 ],
					"source" : [ "obj-38", 0 ]
				}

			}
, 			{
				"patchline" : 				{
					"destination" : [ "obj-12", 0 ],
					"order" : 1,
					"source" : [ "obj-39", 0 ]
				}

			}
, 			{
				"patchline" : 				{
					"destination" : [ "obj-6", 0 ],
					"order" : 0,
					"source" : [ "obj-39", 0 ]
				}

			}
, 			{
				"patchline" : 				{
					"destination" : [ "obj-8", 0 ],
					"source" : [ "obj-4", 0 ]
				}

			}
, 			{
				"patchline" : 				{
					"destination" : [ "obj-38", 3 ],
					"source" : [ "obj-42", 0 ]
				}

			}
, 			{
				"patchline" : 				{
					"destination" : [ "obj-27", 0 ],
					"source" : [ "obj-43", 0 ]
				}

			}
, 			{
				"patchline" : 				{
					"destination" : [ "obj-38", 0 ],
					"source" : [ "obj-47", 0 ]
				}

			}
, 			{
				"patchline" : 				{
					"destination" : [ "obj-12", 1 ],
					"source" : [ "obj-6", 0 ]
				}

			}
, 			{
				"patchline" : 				{
					"destination" : [ "obj-5", 0 ],
					"source" : [ "obj-7", 0 ]
				}

			}
, 			{
				"patchline" : 				{
					"destination" : [ "obj-11", 0 ],
					"order" : 0,
					"source" : [ "obj-8", 0 ]
				}

			}
, 			{
				"patchline" : 				{
					"destination" : [ "obj-2", 0 ],
					"order" : 1,
					"source" : [ "obj-8", 0 ]
				}

			}
, 			{
				"patchline" : 				{
					"destination" : [ "obj-8", 1 ],
					"source" : [ "obj-9", 0 ]
				}

			}
 ],
		"autosave" : 0,
		"styles" : [ 			{
				"name" : "Minimal",
				"default" : 				{
					"fontsize" : [ 10.0 ],
					"elementcolor" : [ 0.694117647058824, 0.694117647058824, 0.694117647058824, 1.0 ],
					"editing_bgcolor" : [ 0.956862745098039, 0.956862745098039, 0.956862745098039, 1.0 ],
					"accentcolor" : [ 0.0, 0.0, 0.0, 1.0 ],
					"fontname" : [ "Futura Medium" ],
					"clearcolor" : [ 1.0, 1.0, 1.0, 0.0 ],
					"selectioncolor" : [ 0.0, 0.0, 0.0, 1.0 ],
					"color" : [ 0.0, 0.0, 0.0, 1.0 ],
					"fontface" : [ 0 ],
					"bgfillcolor" : 					{
						"type" : "color",
						"color" : [ 0.65098, 0.666667, 0.662745, 1.0 ],
						"color1" : [ 0.65098, 0.666667, 0.662745, 1.0 ],
						"color2" : [ 0.290196, 0.309804, 0.301961, 1.0 ],
						"angle" : 270.0,
						"proportion" : 0.39,
						"autogradient" : 0.0
					}
,
					"bgcolor" : [ 0.999999, 0.999974, 0.999991, 1.0 ],
					"textcolor_inverse" : [ 0.0, 0.0, 0.0, 1.0 ]
				}
,
				"parentstyle" : "",
				"multi" : 0
			}
 ]
	}

}
